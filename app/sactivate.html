<!doctype html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Pack | Activate</title>

    <!-- Disable tap highlight on IE -->
    <meta name="msapplication-tap-highlight" content="no">

    <!-- Web Application Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="TCapsule Web App">
    <link rel="icon" sizes="192x192" href="images/touch/chrome-touch-icon-192x192.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Web Starter Kit">
    <link rel="apple-touch-icon" href="images/touch/apple-touch-icon.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#2F3BA2">

    <!-- Color the status bar on mobile devices -->
    <meta name="theme-color" content="#2F3BA2">
    
    <!-- Firebase URL -->
    <script src="https://cdn.firebase.com/js/client/2.4.1/firebase.js"></script>

    <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
    <!--
    <link rel="canonical" href="http://www.example.com/">
    -->

    <!-- Material Design Lite page styles:
    You can choose other color schemes from the CDN, more info here http://www.getmdl.io/customize/index.html
    Format: material.color1-color2.min.css, some examples:
    material.red-teal.min.css
    material.blue-orange.min.css
    material.purple-indigo.min.css
    -->
    <link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.blue_grey-teal.min.css">

    <!-- Material Design icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    <script src="https://storage.googleapis.com/code.getmdl.io/1.0.5/material.min.js"></script>
    
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
   

    <!-- Your styles -->
    <link rel="stylesheet" href="styles/main.css">
    <!--Vladin Combo box -->
    <script src="https://cdn.vaadin.com/vaadin-core-elements/latest/webcomponentsjs/webcomponents-lite.min.js"></script>
    <link rel="import" href="https://cdn.vaadin.com/vaadin-core-elements/master/vaadin-combo-box/vaadin-combo-box.html">
  </head>
  <body class="mdl-demo mdl-color--grey-100 mdl-color-text--grey-700 mdl-base" onload="javascript:loadData()">
   
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header class="mdl-layout__header mdl-layout__header--scroll mdl-color--primary">
          
        <div class="mdl-layout--large-screen-only mdl-layout__header-row">
          <h4>Study Pack</h4>
        </div>
     
        <div class="mdl-layout__tab-bar mdl-js-ripple-effect mdl-color--primary-dark">
          <a href="#overview" class="mdl-layout__tab is-active">Complete Account Creation</a>
          <div style="text-align: center; position:relative; width: 100%; border-width: 1px 0 0 0; ">
              <button class="mdl-button mdl-button--raised mdl-button--accent" style="position: absolute; right: 50px ; top: 15px;" type="button" onclick="cancel();">Cancel Registration</button>
          </div>
        </div>
      </header>
      <main class="mdl-layout__content">
        <div class="mdl-layout__tab-panel is-active" id="overview">
          <section class="section--center mdl-grid mdl-grid--no-spacing mdl-shadow--2dp">
           <form id="activateform">
            <div class="mdl-card mdl-cell mdl-cell--12-col">
              <div class="mdl-card__supporting-text">
                <h4>Complete Sign Up To Activate Account</h4>
              
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text" id="fname" pattern="[a-z,A-Z,0-9,á,é,í,ó,ú,â,ê,ô,ã,õ,ç,Á,É,Í,Ó,Ú,Â,Ê,Ô,Ã,Õ,Ç,ü,ñ,Ü,Ñ,' ']+">
                    <label class="mdl-textfield__label" for="fname"></label>
                    <span class="mdl-textfield__error">Alphanumeric Characters only</span>
                </div>
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text" id="lname" pattern="[a-z,A-Z,0-9,á,é,í,ó,ú,â,ê,ô,ã,õ,ç,Á,É,Í,Ó,Ú,Â,Ê,Ô,Ã,Õ,Ç,ü,ñ,Ü,Ñ,' ']+">
                    <label class="mdl-textfield__label" for="lname"></label>
                    <span class="mdl-textfield__error">Alphanumeric Characters only</span>
                </div>
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text" pattern="[0-9]*" id="phone">
                    <label class="mdl-textfield__label" for="phone">Phone</label>
                    <span class="mdl-textfield__error">Enter digits only</span>
                </div>
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text" pattern="[^@]+@[^@]+\.[a-zA-Z]{2,6}" id="email" disabled>
                    <label class="mdl-textfield__label" for="email"></label>
                    <span class="mdl-textfield__error">Enter a Valid Email</span>
                </div>
                <div class="mdl-textfield mdl-js-textfield">
                   <vaadin-combo-box id="sgrade" label="Current Grade"></vaadin-combo-box>
                </div>
                <div class="mdl-textfield mdl-js-textfield">
                     <input class="mdl-textfield__input" type="hidden" id="none">
                </div>
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text" id="username" pattern="[a-z,A-Z,0-9,á,é,í,ó,ú,â,ê,ô,ã,õ,ç,Á,É,Í,Ó,Ú,Â,Ê,Ô,Ã,Õ,Ç,ü,ñ,Ü,Ñ,' ']+">
                    <label class="mdl-textfield__label" for="username">User Name</label>
                    <span class="mdl-textfield__error">Alphanumeric Characters only</span>
                </div>
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="password" id="pass">
                    <label class="mdl-textfield__label" for="pass">Type Password</label>
                    
                </div>
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="password" id="pass2">
                    <label class="mdl-textfield__label" for="pass">Re-Type Password</label>
                    
                </div>
              </div>  
              <div class="mdl-card__actions">
                <button class="mdl-button mdl-button--raised mdl-button--accent" type="button" onclick="registerUser();">Submit and Activate</button>
              </div>
            </div>
           </form> 
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" id="btn3">
              <i class="material-icons">more_vert</i>
            </button>
            <ul class="mdl-menu mdl-js-menu mdl-menu--bottom-right" for="btn3">
              <li class="mdl-menu__item" disabled>Edit Profile</li>  
              <li class="mdl-menu__item">Instructions</li>
            </ul>
          </section>
          <section class="section--footer mdl-color--white mdl-grid">
            <div class="section__circle-container mdl-cell mdl-cell--2-col mdl-cell--1-col-phone">
              <div class="section__circle-container__circle mdl-color--accent section__circle--big"></div>
            </div>
            <div class="section__text mdl-cell mdl-cell--4-col-desktop mdl-cell--6-col-tablet mdl-cell--3-col-phone">
               <h5>It only takes 1 Min to Register</h5>
               It will only take about fiftey seconds or less for you to complete our basic registration.
            </div>
            <div class="section__circle-container mdl-cell mdl-cell--2-col mdl-cell--1-col-phone">
              <div class="section__circle-container__circle mdl-color--accent section__circle--big"></div>
            </div>
            <div class="section__text mdl-cell mdl-cell--4-col-desktop mdl-cell--6-col-tablet mdl-cell--3-col-phone">
              <h5>Check your email for activation code</h5>
              We will send the activation code to your email address. Check your spam folder if you haven't recieved.
            </div>
          </section>
        </div>
        <footer class="mdl-mega-footer">
          <div class="mdl-mega-footer--middle-section">
            <div class="mdl-mega-footer--drop-down-section">
              <input class="mdl-mega-footer--heading-checkbox" type="checkbox" checked>
              <h1 class="mdl-mega-footer--heading">Quick Links</h1>
              <ul class="mdl-mega-footer--link-list">
                <li><a href="index.html">Home</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="login.html">Login In</a></li>
              </ul>
            </div>
            <div class="mdl-mega-footer--drop-down-section">
              <input class="mdl-mega-footer--heading-checkbox" type="checkbox" checked>
              <h1 class="mdl-mega-footer--heading">Features</h1>
              <ul class="mdl-mega-footer--link-list">
                <li><a href="#">About</a></li>
                <li><a href="#">Terms</a></li>
                <li><a href="#">Partners</a></li>
                <li><a href="#">Updates</a></li>
              </ul>
            </div>
            <div class="mdl-mega-footer--drop-down-section">
              <input class="mdl-mega-footer--heading-checkbox" type="checkbox" checked>
              <h1 class="mdl-mega-footer--heading">Technology</h1>
              <ul class="mdl-mega-footer--link-list">
                <li><a href="#">How it works</a></li>
                <li><a href="#">Patterns</a></li>
                <li><a href="#">Usage</a></li>
                <li><a href="#">Products</a></li>
              </ul>
            </div>
            <div class="mdl-mega-footer--drop-down-section">
              <input class="mdl-mega-footer--heading-checkbox" type="checkbox" checked>
              <h1 class="mdl-mega-footer--heading">FAQ</h1>
              <ul class="mdl-mega-footer--link-list">
                <li><a href="#">Questions</a></li>
                <li><a href="#">Answers</a></li>
                <li><a href="#">About Us</a></li>
                <li><a href="#">Contact Us</a></li>
              </ul>
            </div>
          </div>
          <div class="mdl-mega-footer--bottom-section">
            <div class="mdl-logo">
              More Information
            </div>
            <ul class="mdl-mega-footer--link-list">
              <li><a href="http://www.appshaven.com" target="_blank">Apps Haven Global</a></li>
              <li><a href="#">Help</a></li>
              <li><a href="#">Privacy and Terms</a></li>
            </ul>
          </div>
        </footer>
      </main>
    </div>

    <script src="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.min.js"></script>
    <!-- build:js(app/) ../../scripts/main.min.js -->
    <script src="scripts/main.js"></script>
    <!-- endbuild -->
    
    
    

    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-73753185-1', 'auto');
      ga('send', 'pageview');
    </script>
    <!-- Built with love using Web Starter Kit -->
    
    <!-- Retrieve saved data string and display on text boxes -->
    
    <script>
        
        var userkey;
        
        function loadData() {
        var account = localStorage.getItem('_account');
        if (!account) return false;
        localStorage.removeItem('_account');
        //decodes a string data encoded using base-64
        account = atob(account);
        //parses to Object the JSON string
        account = JSON.parse(account);
        //do what you need with the Object
        
        //objects all loaded check if user is already in internal db, if so then check active status and login else show form
        var retref = new Firebase('https://tcapsule.firebaseio.com/allusers');
        userkey = account.Email;
        var oemail = userkey.replace(/\./g, ",");
        
        retref.child('clientindex/' + oemail).once('value', function (snap) {
                    
                    if(snap.val() != null){
                        //Email already exists in our index so it is registerd, so check if status is activated
                        retref.child("clientusers").child(snap.val()).child("status").on("value", function(keySnapshot) {
                            
                            if(keySnapshot.val() == "active"){
                                //save sessions take user to main app secure page. Prep Class landing page!
                                
                                    var regdetails = {
                                        ID: snap.val(),
                                        Email: userkey
                                    };
                                    var regdetails = JSON.stringify(regdetails);
                                    
                                    //creates a base-64 encoded ASCII string
                                    regdetails = btoa(regdetails);
                                    //console.log(regdetails);
                                    //save the encoded account to web storage
                                    localStorage.setItem('_regdetails', regdetails);
                               
                                  window.location = 'authuser/';
                
                            }
                            else{
                                //store user data in local storage and take to already registered users verification page
                                 var verdetails = {
                                        ID: snap.val(),
                                        Email: userkey
                                    };
                                 //converts to JSON string the Object
                                verdetails = JSON.stringify(verdetails);
                                //creates a base-64 encoded ASCII string
                                verdetails = btoa(verdetails);
                                //save the encoded account to web storage
                                localStorage.setItem('_verdetails', verdetails);   
                                                                   
                                window.location = "verifyd.html";                               
                                
                            }
                            
                        });
                        
                    }
                    else{
                        
                        //Email is not in our index table so this guys is a rookie!
                        fillFields(account.Name, account.Email);
                        return true;
                   }
                });
       
        }
        
        function fillFields(name, email){
            var narray = name.split(" ");
            document.getElementById("fname").value = narray[0];
            document.getElementById("lname").value = narray[1];
            document.getElementById("email").value = email;
        }
    </script>
    
    <!-- Retrive...-->
    <!--Register User -->
    <script>
     function registerUser(){
        //check to see if fields are empty, and contain required inputs
        var remail = document.getElementById("email").value;
        var rphone = document.getElementById("phone").value;
        
        var rfname =  document.getElementById("fname").value;
        var rlname =  document.getElementById("lname").value;
        var rclass =  document.getElementById("sgrade").value;
        var rusern =  document.getElementById("username").value;
        var rpass =  document.getElementById("pass").value;
        var rpass2 =  document.getElementById("pass2").value;
        
        if( (!/(.+)@(.+){2,}\.(.+){2,}/.test(remail) || remail.length < 1 ) || (!/^[\d\.\-]+$/.test(rphone) || rphone.length < 1 ) || (rfname.length < 1) || (rlname.length < 1) || (rclass.length < 1) || (rusern.length < 1) || (rpass.length < 1) || (rpass2.length < 1) ){
           // invalid data inputed
           alert("Please make sure you enter all form fields as directed by the tool tip text before submitting your details. Cheers!");
       
           return true;           
        } else {
                //Everything is OK...200 
               //check password match before saving
               if(rpass.localeCompare(rpass2) == 0){
                   
                   //passwords match go ahead and generate activation code and create user
                   var passkey = Math.floor((Math.random() * 1000000) + 1);
                   var status = "inactive";
                  
                   setDetails(rfname,rlname,remail,rphone,rclass,rusern,rpass,passkey,status);                  
                   window.location = "verify.html";  
                   
               }
               else{
                   
                    alert("Your passwords do not match. Please make sure the two passwords are the same!");
               }
                            
                   
          }
     }
     
     
    function cancel(){
        window.location = "index.html";      
    }
    
    function setDetails(fname, lname, email, phone, grade, username, passw, passkey, status) {
        var details = {
            Fname: fname,
            Lname: lname,
            Email: email,
            Phone: phone,
            Grade: grade,
            Username: username,
            Passw: passw,
            Passkey: passkey,
            Status: status
        };
        //converts to JSON string the Object
        details = JSON.stringify(details);
        //creates a base-64 encoded ASCII string
        details = btoa(details);
        //save the encoded accout to web storage
        localStorage.setItem('_details', details);
     }
   
   
    </script>
   <!--Register User -->

   <!--Load up Combo box -->
   <script>
  
      window.addEventListener('WebComponentsReady', function() {

        var stgrade = document.querySelector('#sgrade');

        stgrade.items = [
          'Secondary 1', 'Secondary 2', 'Secondary 3', 'Secondary 4', 'Secondary 5', 'Secondary 6'
        ];
      });
    </script>

  </body>
</html>
